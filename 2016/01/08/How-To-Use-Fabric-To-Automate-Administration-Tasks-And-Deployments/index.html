<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>How To Use Fabric To Automate Administration Tasks And Deployments | 目标, 计划, 行动.</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="IntroductionLet’s automate things. Everything.
Let’s also figure out a way to do this using a single tool. One that is easy to program, easy to use. And why not do all this with nothing but SSH instal">
<meta property="og:type" content="article">
<meta property="og:title" content="How To Use Fabric To Automate Administration Tasks And Deployments">
<meta property="og:url" content="http://www.hackhocok.xyz/2016/01/08/How-To-Use-Fabric-To-Automate-Administration-Tasks-And-Deployments/index.html">
<meta property="og:site_name" content="目标, 计划, 行动.">
<meta property="og:description" content="IntroductionLet’s automate things. Everything.
Let’s also figure out a way to do this using a single tool. One that is easy to program, easy to use. And why not do all this with nothing but SSH instal">
<meta property="og:updated_time" content="2016-01-08T07:45:34.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="How To Use Fabric To Automate Administration Tasks And Deployments">
<meta name="twitter:description" content="IntroductionLet’s automate things. Everything.
Let’s also figure out a way to do this using a single tool. One that is easy to program, easy to use. And why not do all this with nothing but SSH instal">
  
    <link rel="alternative" href="/atom.xml" title="目标, 计划, 行动." type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  <link rel="stylesheet" href="/css/style.css" type="text/css">
</head>
<body>
  <div id="container">
    <div class="left-col">
    <div class="overlay"></div>
<div class="intrude-less">
	<header id="header" class="inner">
		<a href="/" class="profilepic">
			
			<img lazy-src="http://7wy48o.com1.z0.glb.clouddn.com/avatar.png?attname=&amp;e=1441353837&amp;token=Aec8AonoRkd68-CASC8h5FC684Qdx-IqFmT9dBsB:sJy7FNlXoX_tWSveON6g1Chj5Rg" class="js-avatar">
			
		</a>

		<hgroup>
		  <h1 class="header-author"><a href="/">HackHook</a></h1>
		</hgroup>

		

		
			<div class="switch-btn">
				<div class="icon">
					<div class="icon-ctn">
						<div class="icon-wrap icon-house" data-idx="0">
							<div class="birdhouse"></div>
							<div class="birdhouse_holes"></div>
						</div>
						<div class="icon-wrap icon-ribbon hide" data-idx="1">
							<div class="ribbon"></div>
						</div>
						
						<div class="icon-wrap icon-link hide" data-idx="2">
							<div class="loopback_l"></div>
							<div class="loopback_r"></div>
						</div>
						
						
						<div class="icon-wrap icon-me hide" data-idx="3">
							<div class="user"></div>
							<div class="shoulder"></div>
						</div>
						
					</div>
					
				</div>
				<div class="tips-box hide">
					<div class="tips-arrow"></div>
					<ul class="tips-inner">
						<li>菜单</li>
						<li>标签</li>
						
						<li>友情链接</li>
						
						
						<li>关于我</li>
						
					</ul>
				</div>
			</div>
		

		<div class="switch-area">
			<div class="switch-wrap">
				<section class="switch-part switch-part1">
					<nav class="header-menu">
						<ul>
						
							<li><a href="/">主页</a></li>
				        
							<li><a href="/archives">所有文章</a></li>
				        
							<li><a href="/tags/随笔">随笔</a></li>
				        
							<li><a href="/site">网站导航</a></li>
				        
						</ul>
					</nav>
					<nav class="header-nav">
						<div class="social">
							
								<a class="github" target="_blank" href="http://github.com/thinklife" title="github">github</a>
					        
								<a class="weibo" target="_blank" href="http://weibo.com/rushking2009" title="weibo">weibo</a>
					        
								<a class="twitter" target="_blank" href="https://twitter.com/dothinklife" title="twitter">twitter</a>
					        
								<a class="quora" target="_blank" href="http://www.quora.com/rushking2014" title="quora">quora</a>
					        
						</div>
					</nav>
				</section>
				
				
				<section class="switch-part switch-part2">
					<div class="widget tagcloud" id="js-tagcloud">
						<a href="/tags/A2/" style="font-size: 20px;">A2</a> <a href="/tags/GTD/" style="font-size: 10px;">GTD</a> <a href="/tags/Mac/" style="font-size: 10px;">Mac</a> <a href="/tags/R/" style="font-size: 10px;">R</a> <a href="/tags/app/" style="font-size: 10px;">app</a> <a href="/tags/dev/" style="font-size: 10px;">dev</a> <a href="/tags/env/" style="font-size: 10px;">env</a> <a href="/tags/gradle/" style="font-size: 10px;">gradle</a> <a href="/tags/linux/" style="font-size: 10px;">linux</a> <a href="/tags/mac/" style="font-size: 20px;">mac</a> <a href="/tags/osgi/" style="font-size: 16.67px;">osgi</a> <a href="/tags/plan/" style="font-size: 13.33px;">plan</a> <a href="/tags/plugin/" style="font-size: 10px;">plugin</a> <a href="/tags/redis/" style="font-size: 10px;">redis</a> <a href="/tags/书单/" style="font-size: 10px;">书单</a> <a href="/tags/产品设计/" style="font-size: 10px;">产品设计</a> <a href="/tags/写作/" style="font-size: 10px;">写作</a> <a href="/tags/原创/" style="font-size: 20px;">原创</a> <a href="/tags/开始/" style="font-size: 10px;">开始</a> <a href="/tags/快捷键/" style="font-size: 10px;">快捷键</a> <a href="/tags/思路/" style="font-size: 10px;">思路</a> <a href="/tags/我/" style="font-size: 10px;">我</a> <a href="/tags/技术/" style="font-size: 13.33px;">技术</a> <a href="/tags/推荐/" style="font-size: 10px;">推荐</a> <a href="/tags/收集/" style="font-size: 10px;">收集</a> <a href="/tags/整理/" style="font-size: 10px;">整理</a> <a href="/tags/日记/" style="font-size: 10px;">日记</a> <a href="/tags/时间管理/" style="font-size: 10px;">时间管理</a> <a href="/tags/每日一贴/" style="font-size: 13.33px;">每日一贴</a> <a href="/tags/知识储备/" style="font-size: 10px;">知识储备</a> <a href="/tags/示例/" style="font-size: 10px;">示例</a> <a href="/tags/素质提升/" style="font-size: 10px;">素质提升</a> <a href="/tags/自我提升/" style="font-size: 10px;">自我提升</a> <a href="/tags/读书笔记/" style="font-size: 13.33px;">读书笔记</a> <a href="/tags/课程/" style="font-size: 10px;">课程</a> <a href="/tags/转摘/" style="font-size: 10px;">转摘</a> <a href="/tags/随笔/" style="font-size: 16.67px;">随笔</a>
					</div>
				</section>
				
				
				
				<section class="switch-part switch-part3">
					<div id="js-friends">
					
			          <a target="_blank" class="main-nav-link switch-friends-link" href="http://www.lishen.me">李参教师</a>
			        
			          <a target="_blank" class="main-nav-link switch-friends-link" href="http://program-think.blogspot.com/">编程随想</a>
			        
			          <a target="_blank" class="main-nav-link switch-friends-link" href="http://www.typing-lessons.org">keyboard</a>
			        
			        </div>
				</section>
				

				
				
				<section class="switch-part switch-part4">
				
					<div id="js-aboutme">一名Geek攻城师，喜欢木头，喜欢电子，喜欢一切新鲜事物。爱于思考对自身在时间管理，方法论等方面的提升。</div>
				</section>
				
			</div>
		</div>
	</header>				
</div>
    </div>
    <div class="mid-col">
      <nav id="mobile-nav">
  	<div class="overlay">
  		<div class="slider-trigger"></div>
  		<h1 class="header-author js-mobile-header hide">HackHook</h1>
  	</div>
	<div class="intrude-less">
		<header id="header" class="inner">
			<div class="profilepic">
				<img lazy-src="http://7wy48o.com1.z0.glb.clouddn.com/avatar.png?attname=&amp;e=1441353837&amp;token=Aec8AonoRkd68-CASC8h5FC684Qdx-IqFmT9dBsB:sJy7FNlXoX_tWSveON6g1Chj5Rg" class="js-avatar">
			</div>
			<hgroup>
			  <h1 class="header-author">HackHook</h1>
			</hgroup>
			
			<nav class="header-menu">
				<ul>
				
					<li><a href="/">主页</a></li>
		        
					<li><a href="/archives">所有文章</a></li>
		        
					<li><a href="/tags/随笔">随笔</a></li>
		        
					<li><a href="/site">网站导航</a></li>
		        
		        <div class="clearfix"></div>
				</ul>
			</nav>
			<nav class="header-nav">
				<div class="social">
					
						<a class="github" target="_blank" href="http://github.com/thinklife" title="github">github</a>
			        
						<a class="weibo" target="_blank" href="http://weibo.com/rushking2009" title="weibo">weibo</a>
			        
						<a class="twitter" target="_blank" href="https://twitter.com/dothinklife" title="twitter">twitter</a>
			        
						<a class="quora" target="_blank" href="http://www.quora.com/rushking2014" title="quora">quora</a>
			        
				</div>
			</nav>
		</header>				
	</div>
</nav>
      <div class="body-wrap"><article id="post-How-To-Use-Fabric-To-Automate-Administration-Tasks-And-Deployments" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2016/01/08/How-To-Use-Fabric-To-Automate-Administration-Tasks-And-Deployments/" class="article-date">
  	<time datetime="2016-01-08T04:45:49.000Z" itemprop="datePublished">2016-01-08</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      How To Use Fabric To Automate Administration Tasks And Deployments
    </h1>
  

      </header>
      
      <div class="article-info article-info-post">
        
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/技术/">技术</a></li></ul>
	</div>

        

        <div class="clearfix"></div>
      </div>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h2><p>Let’s automate things. Everything.</p>
<p>Let’s also figure out a way to do this using a single tool. One that is easy to program, easy to use. And why not do all this with nothing but SSH installed on the remote machine – all commands scripted at a single location for executing locally or on any number of various servers.</p>
<p>Does it not sound brilliant and fab? We agree.</p>
<p>In this DigitalOcean article, Fabric – the [system] administration and application deployment streamlining library – is our subject. We will learn how to install this wonderful tool and see just how easy things can become by simply automating mundane management tasks that would otherwise require jumping through hoops with bash hacks and hard-to-maintain, complex scripts.</p>
<h2 id="Glossary"><a href="#Glossary" class="headerlink" title="Glossary"></a>Glossary</h2><ol>
<li><a href="/#What Is Fabric">What Is Fabric</a>?<ul>
<li>Fabric and Python Programming Language</li>
<li>System/Server Administration</li>
<li>Application Deployment</li>
</ul>
</li>
<li>How to Install Fabric on a Droplet Running Ubuntu / Debian</li>
<li>Fabric’s Features and Integration with SSH<ul>
<li>run (fabric.operations.run)</li>
<li>sudo (fabric.operations.sudo)</li>
<li>local (fabric.operations.local)</li>
<li>get (fabric.operations.get)</li>
<li>put (fabric.operations.put)</li>
<li>prompt (fabric.operations.prompt)</li>
<li>reboot (fabric.operations.reboot)</li>
</ul>
</li>
<li>Fabric’s Helpers: Context Managers<ul>
<li>cd (fabric.context_managers.cd)</li>
<li>lcd (fabric.context_managers.lcd)</li>
<li>path (fabric.context_managers.path)</li>
<li>settings (fabric.context_managers.settings)</li>
<li>prefix (fabric.context_managers.prefix)</li>
</ul>
</li>
<li>Example fabfile For Automating Management Tasks</li>
</ol>
<h1 id="What_Is_Fabric_3F"><a href="#What_Is_Fabric_3F" class="headerlink" title="What Is Fabric?"></a>What Is Fabric?</h1><p>Fabric is a Python library (i.e. a tool to build on) used for interacting with SSH and computer systems [easily] to automate a wide range of tasks, varying from application deployment to general system administration.</p>
<p>Albeit being Python-based, it does not mean that it is used strictly for working with other Python applications or tools. In fact, Fabric is there for you to achieve just about anything regardless of a specific language or a system. As long as the very basic requirements are met, you can take advantage of this excellent library.</p>
<p>Fabric scripts are basic Python files. They are run using the fab tool that is shipped with with Fabric. All this does is include (i.e. import ..) your script (i.e. instructions to perform) and execute the provided procedure.</p>
<p>Say “Hello Fab!” using Fabric (fabfile.py):</p>
<pre><code># def hello(who=&quot;world&quot;):
#    print &quot;Hello {who}!&quot;.format(who=who)

$ fab hello:who=Fab
Hello Fab!
</code></pre><h3 id="Fabric_and_Python_Programming_Language"><a href="#Fabric_and_Python_Programming_Language" class="headerlink" title="Fabric and Python Programming Language"></a>Fabric and Python Programming Language</h3><p>As we have briefly mentioned above, although Fabric can be used in a very large scale of scenarios, it is a Python based library and fabfiles need to be programmed using the Python Programming Language.</p>
<p>Regardless of your experience with any other programming language (including Python), as you make your way through our Fabric articles, you will learn how to work with this tool and it shall not take you long to see how simplistic and wonderful it is.</p>
<p>Python is an extremely popular, widely adopted general purpose (i.e. not created to solve a specific problem) programming language. It can be easily distinguished by the importance it puts on code readability and simplicity. To understand Python, check out the very short Python Enhancement Proposal (PEPs) 20 The Zen of Python, followed by bit long Style Guide for Python Code.</p>
<p>In order to have an overall understanding of what programming in Python might be like, you can read a few of the great articles listed at Python Beginner’s Guide.</p>
<h3 id="System/Server_Administration"><a href="#System/Server_Administration" class="headerlink" title="System/Server Administration"></a>System/Server Administration</h3><p>One of the key areas for using Fabric is automating the everyday tasks of system (and server) administration. These jobs include pretty much everything that relates to:</p>
<ul>
<li>Building a server;</li>
<li>Its maintenance, and;</li>
<li>Monitoring.</li>
</ul>
<p>When you begin working with your very own droplet (which is a fully-fledged virtualised server with full control / access), things that appear as a mystery will quickly start to become familiar to you. As you deploy your applications and start dealing with their maintenance, it is only natural to expect that you will be running into some issues. However, when your application gains popularity and things start to grow, the need of managing multiple droplets and repeating everything over and over again ceases to become fun.</p>
<p>That is exactly when you will wish you had met Fabric years ago.</p>
<h3 id="Application_Deployment"><a href="#Application_Deployment" class="headerlink" title="Application Deployment"></a>Application Deployment</h3><p>Deploying an application (regardless of it being a web site, an API, or a server) usually means setting up a system from scratch (or from a snapshot taken in time), preparing it by updating everything, downloading dependencies, setting up the file structure and permissions, followed by finally uploading your codebase - or downloading it using a SCM such as Git.</p>
<p>During the development process, you are also likely to have commands that need to be routinely executed (ex: right before entering a deployment cycle).</p>
<p>Being able to script these tasks (both local and remote) in a logically organized and – most importantly – programmable manner proves to be invaluable shortly after you realize how much time is being wasted repeating the same steps constantly, rendering everything error-prone during the process.</p>
<p>This is exactly when Fabric comes to your aid in the form of a Python file that will know what to do and where to do it.  </p>
<h1 id="How_to_Install_Fabric_on_a_Droplet_Running_Ubuntu_/_Debian_3F"><a href="#How_to_Install_Fabric_on_a_Droplet_Running_Ubuntu_/_Debian_3F" class="headerlink" title="How to Install Fabric on a Droplet Running Ubuntu / Debian?"></a>How to Install Fabric on a Droplet Running Ubuntu / Debian?</h1><p>An easy and cohesive way of installing Fabric is by using the default operating system package manager aptitude.</p>
<p>In order to install Fabric using aptitude, run the following:</p>
<pre><code>sudo aptitude install fabric

# Alternatively, you can also use *pip*:
# pip install fabric
</code></pre><h1 id="Fabric_u2019s_Features_and_Integration_with_SSH"><a href="#Fabric_u2019s_Features_and_Integration_with_SSH" class="headerlink" title="Fabric’s Features and Integration with SSH"></a>Fabric’s Features and Integration with SSH</h1><p>Out of the box, any Python command (or procedure) and module can be utilised through Fabric - given that Fabric is indeed a Python library.</p>
<p>What Fabric really brings to the table is its extensive and excellent integration with SSH that allows streamlining everything using simple scripts (i.e. fabfile.py).</p>
<p>In this section, you can find a selection of tools (e.g. functions) that come with Fabric which can be used to interact with environments where commands you specify are executed.</p>
<p>Note: You can see and learn more about Fabric’s operations by visiting its documentation on the subject.</p>
<h3 id="run__28fabric-operations-run_29"><a href="#run__28fabric-operations-run_29" class="headerlink" title="run (fabric.operations.run)"></a>run (fabric.operations.run)</h3><p>Fabric’s run procedure is used for executing a shell command on one or more remote hosts.</p>
<ul>
<li>The output results of run can be captured using a variable.</li>
<li>If command succeeded or failed can be checked using .failed and .succeeded.</li>
</ul>
<p>Usage examples:</p>
<pre><code># Create a directory (i.e. folder)
run(&quot;mkdir /tmp/trunk/&quot;)

# Uptime
run(&quot;uptime&quot;)

# Hostname
run(&quot;hostname&quot;)

# Capture the output of &quot;ls&quot; command
result = run(&quot;ls -l /var/www&quot;)

# Check if command failed
result.failed
</code></pre><h3 id="sudo__28fabric-operations-sudo_29"><a href="#sudo__28fabric-operations-sudo_29" class="headerlink" title="sudo (fabric.operations.sudo)"></a>sudo (fabric.operations.sudo)</h3><p>Along with run, the most widely used Fabric command is probably sudo. It allows the execution of a given set of commands and arguments with sudo (i.e. superuser) privileges on the remote host.</p>
<p>If sudo command is used with an explicitly specified user, the execution will happen not as root but another (i.e. UID 1010).</p>
<p>Usage examples:</p>
<pre><code># Create a directory
sudo(&quot;mkdir /var/www&quot;)

# Create a directory as another user
sudo(&quot;mkdir /var/www/web-app-one&quot;, user=&quot;web-admin&quot;)

# Return the output
result = sudo(&quot;ls -l /var/www&quot;)
</code></pre><h3 id="local__28fabric-operations-local_29"><a href="#local__28fabric-operations-local_29" class="headerlink" title="local (fabric.operations.local)"></a>local (fabric.operations.local)</h3><p>As we have mentioned in our introduction, a single Fabric script (fabfile) can be used to perform actions both on the local machine and remote system(s). For this purpose, Fabric provides the local operative to run commands locally.</p>
<p>Unlike run or sudo, however, interacting with the output of local the same way is not possible. Either output can be captured or printed – the switch can be set with capture argument.</p>
<p>Local helpers such as the lcd context manager (which is used for setting the local working directory) are honoured with local, the same way run (or sudo) honours the cd context manager.</p>
<p>Usage examples:</p>
<pre><code># Create a source distribution tar archive (for a Python App.)
local(&quot;python setup.py sdist --formats=gztar&quot;, capture=False)

# Extract the contents of a tar archive
local(&quot;tar xzvf /tmp/trunk/app.tar.gz&quot;)

# Remove a file
local(&quot;rm /tmp/trunk/app.tar.gz&quot;)
</code></pre><h3 id="get__28fabric-operations-get_29"><a href="#get__28fabric-operations-get_29" class="headerlink" title="get (fabric.operations.get)"></a>get (fabric.operations.get)</h3><p>The get command exists to download (i.e. pull) file(s) from the remote system to the computer where the Fabric is being used. It is similar to how scp works and comes in handy when you need to download backups, logging data or some other server related items.</p>
<p>You can specify the remote path with the remote_path argument.</p>
<p>You can specify the local - download - path with the local_path argument.</p>
<p>Usage examples:</p>
<pre><code># Download some logs
get(remote_path=&quot;/tmp/log_extracts.tar.gz&quot;, local_path=&quot;/logs/new_log.tar.gz&quot;)

# Download a database back-up
get(&quot;/backup/db.gz&quot;, &quot;./db.gz&quot;)
</code></pre><h3 id="put__28fabric-operations-put_29"><a href="#put__28fabric-operations-put_29" class="headerlink" title="put (fabric.operations.put)"></a>put (fabric.operations.put)</h3><p>When you need to upload files, put command can be used very similarly to get. You can again access the results of command’s execution with .failed or .succeeded.</p>
<p>local_path - set the local path.</p>
<p>remote_path - set the remote path.</p>
<p>use_sudo - upload the file to anywhere on the remote machine using a nifty trick: upload to a temporary location then move.</p>
<p>mode - set the file mode (flags).</p>
<p>mirror_local - set the file flags (i.e. make executable) automatically by reading the local file’s mode.</p>
<p>Usage examples:</p>
<pre><code># Upload a tar archive of an application
put(&quot;/local/path/to/app.tar.gz&quot;, &quot;/tmp/trunk/app.tar.gz&quot;)

# Use the context manager `cd` instead of &quot;remote_path&quot; arg.
# This will upload app.tar.gz to /tmp/trunk/
with cd(&quot;/tmp&quot;):
    put(&quot;local/path/to/app.tar.gz&quot;, &quot;trunk&quot;)

# Upload a file and set the exact mode desired
upload = put(&quot;requirements.txt&quot;, &quot;requirements.txt&quot;, mode=664)

# Verify the upload
upload.succeeded
</code></pre><h3 id="prompt__28fabric-operations-prompt_29"><a href="#prompt__28fabric-operations-prompt_29" class="headerlink" title="prompt (fabric.operations.prompt)"></a>prompt (fabric.operations.prompt)</h3><p>When you find yourself in need of some extra flexibility working with Fabric, prompt will come to your rescue. This command does exactly what its name suggests and asks the user (i.e. one that is running the script) to input a certain data to use during the successive execution.</p>
<p>If you are using a single file to manage with multiple applications, for example, you can use prompt to set one to perform the actions.</p>
<p>Before starting with anything, prompt can also be used to query the port number to use.</p>
<p>Usage examples:</p>
<pre><code># Prompt the user
port_number = prompt(&quot;Which port would you like to use?&quot;)

# Prompt the user with defaults and validation
port_number = prompt(&quot;Which port?&quot;, default=42, validate=int)
</code></pre><h3 id="reboot__28fabric-operations-reboot_29"><a href="#reboot__28fabric-operations-reboot_29" class="headerlink" title="reboot (fabric.operations.reboot)"></a>reboot (fabric.operations.reboot)</h3><p>The reboot command is also self explanatory: it is used to reboot the remote system. By default, it waits two minutes (i.e. 120 seconds -&gt; wait=120) before doing its job.</p>
<p>Usage examples:</p>
<pre><code># Reboot the remote system
reboot()

# Reboot after 30 seconds
reboot(wait=30)
</code></pre><h1 id="Fabric_u2019s_Helpers_3A_Context_Managers"><a href="#Fabric_u2019s_Helpers_3A_Context_Managers" class="headerlink" title="Fabric’s Helpers: Context Managers"></a>Fabric’s Helpers: Context Managers</h1><p>Fabric’s context managers are used with the Python’s with statement. The reason for this is how sessions between execution of commands are not kept between shell-less connections.</p>
<p><strong>Note</strong>: You can see and learn more about Fabric’s context managers by visiting its documentation on the subject.</p>
<h3 id="cd__28fabric-context_managers-cd_29"><a href="#cd__28fabric-context_managers-cd_29" class="headerlink" title="cd (fabric.context_managers.cd)"></a>cd (fabric.context_managers.cd)</h3><p>cd context manager allows keeping the directory state (i.e. where the following block of comments are to be executed). It is similar to running the cd command during an SSH session and running various different commands.</p>
<p>Usage examples:</p>
<pre><code># The *cd* context manager makes enwrapped command&apos;s
# execution relative to the stated path (i.e. &quot;/tmp/trunk&quot;)
with cd(&quot;/tmp/trunk&quot;):
    items = sudo(&quot;ls -l&quot;)

# It is possible to &quot;chain&quot; context managers
# The run commands gets executed, therefore at &quot;/tmp/trunk&quot;
with cd(&quot;/tmp&quot;):
    with cd(&quot;/trunk&quot;):
        run(&quot;ls&quot;)
</code></pre><h3 id="lcd__28fabric-context_managers-lcd_29"><a href="#lcd__28fabric-context_managers-lcd_29" class="headerlink" title="lcd (fabric.context_managers.lcd)"></a>lcd (fabric.context_managers.lcd)</h3><p>The lcd context manager (local cd) works very similarly to one above (cd); however, it only affects the local system’s state.</p>
<p>Usage examples:</p>
<pre><code># Change the local working directory to project&apos;s
# and upload a tar archive
with lcd(&quot;~/projects/my_project&quot;):
    print &quot;Uploading the project archive&quot;
    put(&quot;app.tar.gz&quot;, &quot;/tmp/trunk/app.tar.gz&quot;)
</code></pre><h3 id="path__28fabric-context_managers-path_29"><a href="#path__28fabric-context_managers-path_29" class="headerlink" title="path (fabric.context_managers.path)"></a>path (fabric.context_managers.path)</h3><p>path context managers alters the PATH variable.</p>
<h3 id="settings__28fabric-context_managers-settings_29"><a href="#settings__28fabric-context_managers-settings_29" class="headerlink" title="settings (fabric.context_managers.settings)"></a>settings (fabric.context_managers.settings)</h3><p>When you need to temporarily (i.e. for a certain command chain), you can use the settings statement (i.e. override env values).</p>
<p>Usage examples:</p>
<pre><code># Perform actions using a different *user*
with settings(user=&quot;user1&quot;):
    sudo(&quot;cmd&quot;)
</code></pre><h3 id="prefix__28fabric-context_managers-prefix_29"><a href="#prefix__28fabric-context_managers-prefix_29" class="headerlink" title="prefix (fabric.context_managers.prefix)"></a>prefix (fabric.context_managers.prefix)</h3><p>prefix statement does what its name suggests and wraps given run and sudo command with the specified one.</p>
<p>Usage examples:</p>
<pre><code>with prefix(&quot;cmd arg.&quot;):
    run(&quot;./start&quot;)
# cmd arg. &amp;&amp; ./start
</code></pre><h1 id="Example_fabfile_For_Automating_Management_Tasks"><a href="#Example_fabfile_For_Automating_Management_Tasks" class="headerlink" title="Example fabfile For Automating Management Tasks"></a>Example fabfile For Automating Management Tasks</h1><p>To begin learning how to program a fabfiles to automate a simple management task, let’s create an empty <code>fabfile.py</code>.</p>
<p>Run the following command to create a <code>fabfile.py</code> using the text editor nano:</p>
<pre><code>nano fabfile.py
</code></pre><p>Append the following code block updating the system and installing memcached:</p>
<pre><code># Fabfile to:
#    - update the remote system(s) 
#    - download and install an application

# Import Fabric&apos;s API module
from fabric.api import *


env.hosts = [
    &apos;server.domain.tld&apos;,
  # &apos;ip.add.rr.ess
  # &apos;server2.domain.tld&apos;,
]
# Set the username
env.user   = &quot;root&quot;

# Set the password [NOT RECOMMENDED]
# env.password = &quot;passwd&quot;

def update_upgrade():
    &quot;&quot;&quot;
        Update the default OS installation&apos;s
        basic default tools.
                                            &quot;&quot;&quot;
    run(&quot;aptitude    update&quot;)
    run(&quot;aptitude -y upgrade&quot;)

def install_memcached():
    &quot;&quot;&quot; Download and install memcached. &quot;&quot;&quot;
    run(&quot;aptitude install -y memcached&quot;)

def update_install():

    # Update
    update_upgrade()

    # Install
    install_memcached()
</code></pre><p>Save and exit using CTRL+X and confirm with with Y.</p>
<p>Now you can start automating your mundane server management tasks using Fabric and its features explained here.</p>
<pre><code># Automate everything!
fab update_install
</code></pre><p><a href="https://www.digitalocean.com/community/tutorials/how-to-use-fabric-to-automate-administration-tasks-and-deployments" target="_blank" rel="external">原文</a></p>

      
    </div>
    
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2016/01/08/八大利器，彰显程序猿B格范/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption"><</strong>
      <div class="article-nav-title">
        
          八大利器，彰显程序猿Ｂ格范
        
      </div>
    </a>
  
  
    <a href="/2016/01/08/e插件开发简单示例-md/" id="article-nav-older" class="article-nav-link-wrap">
      <div class="article-nav-title">e插件开发简单示例.md</div>
      <strong class="article-nav-caption">></strong>
    </a>
  
</nav>

  
</article>


<div class="share">
	<!-- JiaThis Button BEGIN -->
	<div class="jiathis_style">
		<span class="jiathis_txt">分享到：</span>
		<a class="jiathis_button_tsina"></a>
		<a class="jiathis_button_cqq"></a>
		<a class="jiathis_button_douban"></a>
		<a class="jiathis_button_weixin"></a>
		<a class="jiathis_button_tumblr"></a>
		<a href="http://www.jiathis.com/share" class="jiathis jiathis_txt jtico jtico_jiathis" target="_blank"></a>
	</div>
	<script type="text/javascript" src="http://v3.jiathis.com/code/jia.js?uid=1405949716054953" charset="utf-8"></script>
	<!-- JiaThis Button END -->
</div>



<div class="duoshuo">
	<!-- 多说评论框 start -->
	<div class="ds-thread" data-thread-key="How-To-Use-Fabric-To-Automate-Administration-Tasks-And-Deployments" data-title="How To Use Fabric To Automate Administration Tasks And Deployments" data-url="http://www.hackhocok.xyz/2016/01/08/How-To-Use-Fabric-To-Automate-Administration-Tasks-And-Deployments/"></div>
	<!-- 多说评论框 end -->
	<!-- 多说公共JS代码 start (一个网页只需插入一次) -->
	<script type="text/javascript">
	var duoshuoQuery = {short_name:"true"};
	(function() {
		var ds = document.createElement('script');
		ds.type = 'text/javascript';ds.async = true;
		ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
		ds.charset = 'UTF-8';
		(document.getElementsByTagName('head')[0] 
		 || document.getElementsByTagName('body')[0]).appendChild(ds);
	})();
	</script>
	<!-- 多说公共JS代码 end -->
</div>




</div>
      <footer id="footer">
  <div class="outer">
    <div id="footer-info">
    	<div class="footer-left">
    		&copy; 2016 HackHook
    	</div>
      	<div class="footer-right">
      		<a href="http://hexo.io/" target="_blank">Hexo</a>  Theme <a href="https://github.com/litten/hexo-theme-yilia" target="_blank">Yilia</a> by Litten
      	</div>
    </div>
  </div>
</footer>
    </div>
    
  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css" type="text/css">


<script>
	var yiliaConfig = {
		fancybox: true,
		mathjax: true,
		animate: true,
		isHome: false,
		isPost: true,
		isArchive: false,
		isTag: false,
		isCategory: false,
		open_in_new: false
	}
</script>
<script src="http://7.url.cn/edu/jslib/comb/require-2.1.6,jquery-1.9.1.min.js" type="text/javascript"></script>
<script src="/js/main.js" type="text/javascript"></script>



<!-- Google Analytics -->
<script type="text/javascript">
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-67162812-1', 'auto');
ga('send', 'pageview');

</script>
<!-- End Google Analytics -->




<script type="text/x-mathjax-config">
MathJax.Hub.Config({
    tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
        processEscapes: true,
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
    }
});

MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
        all[i].SourceElement().parentNode.className += ' has-jax';                 
    }       
});
</script>

<script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>


  </div>
</body>
</html>